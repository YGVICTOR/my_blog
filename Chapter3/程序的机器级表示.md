在第一章讲述计算机漫游时，我们曾提到过编译系统的工作流程。本节我们详细介绍一下C语言、汇编代码以及机器代码之间的关系。理解汇编代码与原始C代码之间的关系，是理解计算机如何执行程序的关键一步。因此，稍微花一些时间来学习一下汇编语言，对理解计算机系统是非常有必要的。



我们先来简单了解一下Intel处理器的发展历史。1978年Intel发布了第一款微处理器-8086，在接下来的四十多年里，Intel不断地推出新的处理器，从最早的16位扩展到32位，近些年又扩展到64位，视频中代码的运行环境就是Intel-x86-64位的处理器，操作系统是linux。

接下来，我们看一个C代码的例子，这个示例中包含两个源文件，一个是main.c，另外一个是mstore.c,我们可以通过图中的命令编译这些代码，其中`gcc`指的就是`gcc`编译器，它是linux系统上**默认的编译器** ，其中编译选项`-Og`是用来告诉编译器生成符合原始C代码整体结构的机器代码。在实际项目中，为了获得更高的性能，会使用`-O1`或者`-O2`,甚至更高的编译优化选项。但是使用高级别的优化产生的代码会严重变形，导致产生的机器代码与最初的源代码之间的关系难以理解，此处为了方便理解，因此选择`-Og`这个优化选项。`-o`后面跟的参数`prog`表示生成可执行文件的文件名。关于更多链接方面的知识，将会在第七章做更详细的讲解。

```shell
linux > gcc -Og -o prog main.c mstore.c
```



首先，我们以源文件`mstore.c`为例，看一下代码与汇编代码之间的关系，使用图中的这条命令可以生成`mstore.c`所对应的汇编文件`mstore.s`,其中`-S`这个编译选项就是告诉编译器`GCC`产生的文件为汇编文件，我们可以用编辑器**(vim)**打开这个汇编文件。

其中以"."开头的行都是指导汇编器和链接器工作的伪指令，也就是说我们完全可以忽略这些以“."开头的行。



删除了无关的信息之后，剩余这些汇编代码与源文件中C代码是相关的，接下来我们看一下这段C程序所对应的第一条汇编代码。

![image-20240615002236744](.\pic\image-20240615002236744.png)

![image-20240615003536919](.\pic\image-20240615003536919.png)